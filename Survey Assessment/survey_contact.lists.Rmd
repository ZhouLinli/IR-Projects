---
title: "Alchemer Survey Contact Lists"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(tidyverse)
library(writexl)
library(stringr)
```

# Alchemer contact list requirements:

Need to be exactly "First Name", "Last Name", "Email" as col name to be able to upload on alchemer


# First Impression Survey: contact list for reminder

Context:

FIS was initially send out as a public link. The only student identifier was students' email. 

For those who did not respond to FIS' public link, we are sending a "reminder", which is an individual invitation that need to have a contact list.

This reminder contact list need to only include those students who did not respond to the public survey, as well as related alchemer needed info (their ppid, first, last name, email address). 

To filter out students who completed the survey through public link, I used the email column to match with student backup data. Below are the codes for that: 


```{r acm survey}
#initial survey dataset: students who completed FIS via public link
acm<-read_excel("/Volumes/lasellshare/Faculty_Staff_Shares$/IR/Surveys/Lasell Internal/First Impressions/2022 Fall/archive/alchemer9.26_raw.xlsx")%>%
  rename(email=`Please provide your Lasell email address. This information is needed for research purposes. Your personal information will be kept confidential and will not appear on any report.Â `)

#get emails
#must do mutate and filter separatedly from read excel to avoid confusing reading order
acm<-acm%>%mutate(email=gsub("@lasell.edu","",acm$email),
         email=str_to_lower(email))%>%  #119  
            filter(!is.na(email))#116

#part<-acm%>%filter(Status=="Partial")#don't worry about it
```

```{r allstu22}
#all students who are supposed to complete First impression survey
allstu22<-read_excel("/Volumes/lasellshare/Faculty_Staff_Shares$/IR/Registrar Reports/2022 Fall/Fall 2022 UG Backup Data Report.xlsx")
#select vars
allstu22<-allstu22%>%
  filter(`Cohort Id`=="2022")%>%#only first year students are supposed to complete first impression survey
  select(`People Code Id`, Name,`Lasell email`)%>%#vars needed
  rename(email=`Lasell email`)#rename for convinience

#must do rename and mutate (using new name) separatedly
allstu22<-allstu22%>%
  #replace @lasell.edu with blank for all email
  mutate(email=gsub("@lasell.edu","",allstu22$email),
         email=str_to_lower(email))

#get names  
allstu22<-allstu22%>%
 #split name before and after "," into two columns and select the first and second cols respectively      
  mutate(`Last Name`=str_trim(str_split_fixed(allstu22$Name,",",2)[,1]),
         `First Name`=str_trim(str_split_fixed(Name,",",2)[,2]))%>%
  select(-Name)#remove used name var
#check: nrow(allstu22) #have 314 students in this all 2022 students dataset (i.e. students that are supposed to answer FIS)
```

```{r match email}
#contact list will be consisted of all allstu22 that are NOT in the acm dataset (who already answered the survey via a public link)
contact<-allstu22[(allstu22$email%in%acm$email==FALSE),]%>%#209 students
  rename(Email=email)#need to be exactly "Email" as col name to be able to upload on alchemer

#save the contact list: 
#write.xlsx(contact,file="/Volumes/lasellshare-1/Faculty_Staff_Shares$/IR/Surveys/Lasell Internal/First Impressions/2022 Fall/ReminderContactList9.26.xlsx")
```

