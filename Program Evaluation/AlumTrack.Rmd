---
title: "AlumTracking"
author: "Linli Zhou"
date: "2022-08-17"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load package}
library(readxl)
library(dplyr)
```

# Research question: 
1. Postgrad Life Basic: 1) How many alumni are employed/unemployed/continue-ed across years? 2) What are the most popular title/degree and employers/institutions?

- variables needed: 1) EMPLOYED, TITLE, EMPLOYER; 2) not/continue-ed+institution/degree
- data source: 1) historical.data append with survey and linkedin; 2)clearinghouse

2. What are alum's top interests in Lasell alum activities?

- variables needed: INTEREST
- data source: historical.data append with survey

3. Employ-ability/Continue-edu characteristics: 1) Which major/degree are most employable across different years for grad and undergrad? 2) How demographic (gender, race) correlate with employment?

- variables needed: level/gradyear,school/major/degree, gender/race
- data source: ipeds.complete.16-current

# Data Prep 

## IPEDS.Complete

```{r ipeds for merge clean df}
ipeds.16crt<-read_excel("/Users/linlizhou/Documents/LASELL/data/completion/16-current.xlsx")

```


## Grad Alumni 6 month

```{r read data}
#gd6m target data
#find sheet
excel_sheets("/Users/linlizhou/Documents/LASELL/data/alumni/2021Grad6m_historic.xlsx")#only one sheet
#read historical data
gd6m<-read_excel("/Users/linlizhou/Documents/LASELL/data/alumni/2021Grad6m_historic.xlsx")

#read survey data
survey<-read_excel("/Users/linlizhou/Documents/LASELL/data/alumni/2021Gd6mSurvey_renamed.xlsx")

#read linkedin data
linkedin<-read_excel("/Users/linlizhou/Documents/LASELL/data/alumni/2021Gd6mLinkedin_rename.xlsx")
```

```{r select vars}
#select gd6m vars to be gd6m_s 
gd6m_s<-gd6m%>%select(
  PC_ID, 
  `Employed/Ed`, #EMPLOYED VAR
  Employment_Organization, #EMPLOYER VAR
  Employment_JobTitle, #TITLE VAR
  Employed_income...30, #INCOME CAT VAR
  starts_with("Interest_")#INTEREST VAR
)
#rename for consistency across all df
names(gd6m_s)<-c("PCID","Employment","Employer","Title","Income",names(gd6m_s)[6:15])
#check col number
ncol(gd6m_s)

#select survey to be survey_s
survey_s<-survey%>%select(
  PC_ID,
  `Employment/Unemployed`,
  Employment_Organization,
  Employment_JobTitle,
  Employed_income,
  starts_with("Interest_")
  )
#rename for consistency across all df
names(survey_s)<-c("PCID","Employment","Employer","Title","Income",names(survey_s)[6:15])
#check col number
ncol(survey_s)

#select linkedin to be linkedin_s
linkedin_s<-linkedin%>%select(
  PC_ID,
  Employment,
  Employment_Organization,
  Employment_JobTitle
)
#rename for consistency across all df
names(linkedin_s)<-c("PCID","Employment","Employer","Title")
```

```{r join_all}
#check rows
nrow(gd6m_s)+nrow(survey_s)+nrow(linkedin_s)#1404 rows
#join_all by all common cols
gd6m_m<-plyr::join_all(list(gd6m_s,survey_s,linkedin_s),type="full",match="all")#1404 rows; must use list(dfs)

#rm unused cols
rm(gd6m,gd6m_s,survey,survey_s,linkedin,linkedin_s)
```

```{r interest var mutate}
#combine multi-col into one INTEREST var
gd6m_m<-gd6m_m%>%mutate(Interest=case_when(
  Interest_AlumnCareerNetwork=="Alumni Career Network"~"Career Network",
  
  Interest_JobPosts=="Posting jobs or internships listings for Lasell students"~"Post Jobs",
  
  Interest_CareerFair=="Career Fair" | 
    Interest_CollegeFair=="College Fair"~"Career/College Fair",
  
  Interest_Volunteering=="Volunteering at Lasell events" | 
    Interest_CampusPresentation=="Campus presentation to students" | 
    Interest_Mentor=="Being a mentor to current students" ~"Volunteer",
  
Interest_SocialActivities == "Social activities (sporting events, reunion, etc.)" | 
Interest_Recreational=="Recreational programs (kayaking, hiking, etc.)" ~ "Social",
  
   Interest_AcademicCultural=="Academic/Cultural (lectures, theater, etc.)" ~ "Academic/Cultural"
   ))

#remove all "Interest_" subcols and only keep Interest (mutated conclusive col)
gd6m_m<-gd6m_m%>%select(-starts_with("Interest_"))
```


```{r recode}
#inspect and clean (recode)
gd6m_m%>%group_by(Employment)%>%count()
#recode employed
gd6m_m$Employment<-gd6m_m$Employment%>%recode(
  "FT"="Employed","Intern"="Employed","PT"="Employed","Self"="Employed","Temp"="Employed","Y"="Employed","Yes"="Employed",
  "U"="Unknown","NA"="Unknown",
  "N"="Unemployed","No"="Unemployed")
#check
gd6m_m%>%group_by(Employment)%>%count()
```




