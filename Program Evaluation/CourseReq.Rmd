---
title: "CourseReqreuimentImpact"
author: "Linli Zhou"
date: "2022-08-23"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(tidyverse)
library(stringr)
library(writexl)
```

# Set Up Data
```{r load data}
#which sheet
excel_sheets("/Users/linlizhou/Documents/LASELL/data/enrollment/All Course Requirements.xlsx")
#read data
data<-read_excel("/Users/linlizhou/Documents/LASELL/data/enrollment/All Course Requirements.xlsx",sheet = "Data")
```

```{r select major}
#remove mutated summary col 3-6; remove minors
dat.major<-data%>%select(-names(data)[3:6],-ends_with("Minor"))

#remove NA rows in section
dat.major<-dat.major[!is.na(dat.major$Section),]#removed last several NA rows, change from 941 to 935 row
```


# 43 Majors

## Accounting

```{r html-accounting}
library(RCurl)
library(XML)
#read html and parse it into R readable contents
pg<-htmlParse(getURL("https://www.lasell.edu/academics/academic-catalog-21-22/undergraduate-catalog-21-22/programs-of-study-/accounting-21-22.html"))
#look at all names and counts of names
summary(pg)
#read the table within html contents and save it as a tibble
crs.tbl<-readHTMLTable(pg,stringsAsFactors = FALSE)%>%as_tibble() #a tibble of 30 observation of 1 var

#make a course list
names(crs.tbl)="course" #rename tibble from NULL to "course" so that I can call it by its name without causing error
df<-crs.tbl$course#finally got a dataframe of 3 vars
crs<-df$`Course Code`#character not a list
crs.df<-data.frame(Section=crs)%>%filter(!grepl("School",Section),!grepl("Core Courses",Section))
```


```{r append new courses}
#inspect
new.crs<-crs[(crs %in% dat.major$Section ) == FALSE]
#make new coureses a tibble to be appended
#new.df<-data.frame(Section=c(new.crs[2:6],new.crs[8:12],new.crs[14:15]))#needs to eye ball which are coursese
#make all values in col called Section, then remove with patterns using filter grepl
new.df<-data.frame(Section=new.crs)%>%filter(!grepl("School",Section),!grepl("Choose",Section),!grepl("Core Courses",Section))

#append new.df with dat.major
dat.major<-plyr::join_all(list(dat.major,new.df),type = "full")#change from 935 to 947 with appended rows
```


```{r keep core course}
#investigate
dat.major%>%group_by(Accounting)%>%count()
#recode using case_when (new var= old var name)
dat.major<-
  dat.major%>%mutate(Accounting=case_when(
    Accounting=="C"~"Core",
    Section %in% c(crs[2:11],crs[13:23]) ~"Required",
    Section %in% crs[25:29] ~"Elective"
  ))%>%group_by(Accounting)%>%count()#check directly after mutate, before assign it to df

dat.major$Accounting<-recode(dat.major$Accounting, C="Core",E=NA,X=NA)
```

