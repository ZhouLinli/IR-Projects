---
title: "FacultyTenureAnalysis"
author: "Linli Zhou"
format: pptx
editor: visual
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, include = TRUE, warning=FALSE, message=FALSE, fig.align = "center")
#theme
source("/Users/linlizhou/Documents/Rprojects/IR-Projects/theme_source.R")  #run code from saved r script
#load data
data<-read_excel("/Users/linlizhou/Documents/LASELL/Faculty Data for Analyst Candidates.xlsx")
```

# Agenda

- Tenure status by year
- Tenure status by demography (rank, sex, race)
- Tenure status for small, medium, and large department

```{r clean, results='hide'}
#remove duplicated rows
data<-unique(data)#from 4003 to 3984 observations
#investigate duplicated ID/persons
unique(data$ID)%>%length()#1147 unique ID
data%>% group_by(ID) %>% summarise(cnt=n()) %>%arrange(-cnt) %>%filter(cnt>1) #815 duplicated IDs
#thus, need n_distinct ID in the following codes
```

# Historical Trends

::: notes
- Tenured percentage has been increased since 2016 from 40% to 44% in 2021, with 2020 being the highest 45%. 
- Non-tenured faculty percentage has been decreased from 60% to 56%, with 2020 being the lowest 55%. 
- There are still 12% less tenured faculty than non tenured.
::: 

```{r unique TvsN across year}
data%>%group_by(Year, `Tenure Status`)%>%
summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits=0))%>%

ggplot(aes(color=factor(`Tenure Status`),x=factor(Year),y=prt,group=factor(`Tenure Status`)))+geom_line()+
geom_text(aes(label=prt),fontface="bold", size = 9)+
theme_lz_ppt()+
scale_y_continuous(breaks = seq(.4,.6,by=.05),labels = scales::percent)+
labs(title=str_wrap("Proportion of Faulcty in Different Tenured Status",50),x="",y="")+
scale_color_discrete(labels=c("Non-tenure","Tenure"),name="")+
theme(axis.text.y=element_blank())
```

# Faculty Characteristics: Rank

::: notes
- 2017-2019 is a period for the largest jump of tenured proportion, 13% for AiP and 11% for P. AoP has less jump, and on the contry, experienced a large drop of 6% from 2019 to 2021.
Omitted details below:
- Although from 2016 to 2017, proportion of tenured AiP decreased 6%, it jumped from 57% in 2017 to 75% om 2021, representing a 18% increase over recent 4 years.
- From 2016 to 2019, proportion of tenured AoP increased slightly from 63% to 66%. However, since 2019, the proportion dropped to 60%. AoP is 13-15% lower than AiP and Prof.
- From 2016-2018, proportion of tenured professor dropped from 68% to 65%, while it increased 9% in 2019, and kept 74% in 2020, with a slight drop in 2021 to 73%.
::: 

```{r tenured trend by rank}
#pivot table
data%>% filter(Rank=="Professor"|Rank=="Assistant Professor"| Rank=="Associate Professor")%>%
  group_by(Year, Rank,`Tenure Status`)%>%#2016 professor as a group -> proportions of (non) tenure for all professors in 2016
summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits=0))%>%filter(`Tenure Status`=="Tenure Line")%>%
#plot
ggplot(aes(color=factor(Rank),x=factor(Year),y=prt,group=factor(Rank)))+geom_line()+
geom_text_repel(aes(label=prt),fontface="bold",size=6.5)+
#themes
scale_y_continuous(breaks = seq(.55,.75,by=.1),labels = scales::percent)+
scale_color_discrete(name="")+
theme_lz_ppt()+theme(axis.text.y=element_blank())+
labs(title="Tenured Faculty by Rank",x="",y="")
```

```{r none/tenure by rank, fig.width=8, include=FALSE}
data%>% filter(Rank=="Professor"|Rank=="Assistant Professor"| Rank=="Associate Professor")%>%
  group_by(Rank,`Tenure Status`)%>%summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits=0))%>%

ggplot(aes(fill=factor(`Tenure Status`),x=factor(Rank),y=prt))+
geom_bar(stat = "identity",position = position_dodge())+
geom_text(aes(label=prt),position=position_dodge(.9),vjust=1.5,color="white",fontface="bold", size= 9 )+theme_lz_ppt()+
scale_fill_discrete(labels=c("Non-tenure","Tenure"),name="")+
  scale_x_discrete(labels=c("Assistant Prof", "Associate Prof", "Professor"))+
labs(x="",y="",title="Overall Tenured Status by Rank")

#Assistant Professor has 64% Tenured status, 4% higher than Professor and 6% higher than Associate Professor.
```

# Faculty Characteristics: Race/Ethnicity

::: notes
- White faculty has a stable tenured proportion range within 42-50%
- Asian faculty also has a stable tenured proportion within 32-46%, but proportion is constantly lower than white faculty each year. The largest differences are 8% and 10% in 2017 and 2019.
- International faculty has the lowest tenured proportion of 20% in 2016, but the proportion jumped to 50% in 2018 and 2021.
- Hispanic faculty has increased tenured proportion from 33% in 2016 to 59% in 2020, and 55% in 2021, both are the highest among all racial groups in those two years. 
- Black faculty tenured proportion dropped from 50% in 2017 to 20% in 2018, but has been increasing by 7% each year to 44% in 2020 and kept stable at 45% in 2021.
::: 

```{r facet two race bulk group,fig.width=15}
#race count
nrace<-data%>% filter( !(`Race/Ethnicity`%in% c("Unreported", "Two or More Races",NA)))%>%filter(`Tenure Status`=="Tenure Line")%>%
  group_by(`Race/Ethnicity`)%>%count()%>%arrange(-n)%>%mutate(race=factor(`Race/Ethnicity`))

#create two bulk group and pivot table
racepvt<-data%>%filter( !(`Race/Ethnicity`%in% c("Unreported", "Two or More Races",NA)))%>%mutate(RaceGroup=case_when(
  `Race/Ethnicity` %in% nrace$`Race/Ethnicity`[1:2] ~ "Larger Racial Group",
  `Race/Ethnicity` %in% nrace$`Race/Ethnicity`[3:5] ~ "Smaller Racial Group",))%>%
#pivot table  
  group_by(Year, `Race/Ethnicity`,RaceGroup,`Tenure Status`)%>%#2016 male as a group -> proportions of (non) tenure for all male professors in 2016
summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits=0))%>%filter(`Tenure Status`=="Tenure Line")

#max/min data label
#max.min<-racepvt%>%select(`Race/Ethnicity`,prt)%>%group_by(`Race/Ethnicity`)%>%summarise(max=max(prt),min=min(prt))%>%arrange(min)
  
#plot
racepvt%>%ggplot(aes(x=factor(Year),y=prt,color=factor(`Race/Ethnicity`),linetype=factor(`Race/Ethnicity`),group=factor(`Race/Ethnicity`)))+geom_line()+
  scale_color_manual(name="",limits=nrace$race, values = c("black","blue","chartreuse3","darkgoldenrod","brown1"),labels=c("White","Asian","International","Hispanic","Black"))+  
  scale_linetype_manual(name="",limits=nrace$race, values = c("solid","longdash","twodash","solid","longdash"),labels=c("White","Asian","International","Hispanic","Black"))+
  facet_wrap(~RaceGroup,labeller=labeller(RaceGroup= c(`Larger Racial Group`="Larger Racial Groups (Tenured Faculty>100)", `Smaller Racial Group`="Smaller Racial Groups (10<Tenured Faculty<100)") ) )+
  
geom_text_repel(aes(label=prt),size=5)+
#themes
scale_y_continuous(breaks = seq(.2,1,by=.2),labels = scales::percent)+
theme_lz_ppt()+theme(axis.text.y=element_text(size=12))+theme(panel.grid.major.y = element_line(color = "grey95"), panel.grid.minor.y = element_line(color = "grey95"))+#theme(legend.position = "right", legend.direction = "vertical")+
  guides(color = guide_legend(nrow = 1, byrow = TRUE))+
labs(title=str_wrap("Tenured Faculty by Racial Groups",80),x="",y="")
```


```{r tenured trend by race, fig.width=18, fig.height=6, include=FALSE}
#tenured trend by race top 3
#pivot table
g1race<-
data%>% filter(`Race/Ethnicity`%in% nrace$`Race/Ethnicity`[1:3])%>% group_by(Year, `Race/Ethnicity`,`Tenure Status`)%>%#2016 white as a group -> proportions of (non) tenure for all white professors in 2016
summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits=0))%>%filter(`Tenure Status`=="Tenure Line")%>%
#plot
ggplot(aes(color=factor(`Race/Ethnicity`),x=factor(Year),y=prt,group=factor(`Race/Ethnicity`)))+geom_line()+
  scale_color_manual(name="",limits=nrace$race[1:3],values = c(mycolors[1],mycolors[2],mycolors[4]))+
geom_text_repel(aes(label=prt),fontface="bold",size=6.5)+
#themes
scale_y_continuous(breaks = seq(.3,.5,by=.1),labels = scales::percent)+
theme_lz_ppt()+theme(axis.text.y=element_blank())+
labs(title=str_wrap("Tenured Faculty in Large Racial Groups (n>80)",40),x="",y="")

# tenured trend by race bottom 3
#pivot table
g2race<-
data%>% filter(`Race/Ethnicity`%in% nrace$`Race/Ethnicity`[4:6])%>% group_by(Year, `Race/Ethnicity`,`Tenure Status`)%>%#2016 white as a group -> proportions of (non) tenure for all white professors in 2016
summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits=0))%>%filter(`Tenure Status`=="Tenure Line")%>%
#plot
ggplot(aes(color=factor(`Race/Ethnicity`),x=factor(Year),y=prt,group=factor(`Race/Ethnicity`)))+geom_line()+
  scale_color_manual(name="",limits=nrace$race[4:6],values = c(mycolors[6],mycolors[7],mycolors[5]))+
geom_text_repel(aes(label=prt),fontface="bold",size=6.5)+
#themes
scale_y_continuous(breaks = seq(.3,.5,by=.1),labels = scales::percent)+
theme_lz_ppt()+theme(axis.text.y=element_blank())+
labs(title=str_wrap("Tenured Faculty in Small Racial Groups (n<80)",40),x="",y="")

gridExtra::grid.arrange(g1race,g2race, ncol = 2)
```

# Faculty Characteristics: Legal Sex

::: notes

::: 

```{r tenured trend by sex in different race, fig.width=15}
#pivot table
data%>% filter(`Race/Ethnicity`!="Unreported")%>% group_by(Year,`Race/Ethnicity`, `Tenure Status`,`Legal Sex`)%>%#2016 male as a group -> proportions of (non) tenure for all male professors in 2016
summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits=0))%>%filter(`Tenure Status`=="Tenure Line")%>%
#plot
ggplot(aes(color=factor(`Legal Sex`),x=factor(Year),y=prt,group=factor(`Legal Sex`)))+geom_line()+facet_wrap(~`Race/Ethnicity`)+
#geom_text_repel(aes(label=prt),fontface="bold",size=6.5)+
#themes
scale_y_continuous(breaks = seq(.2,.8,by=.2),labels = scales::percent)+
#scale_x_discrete(labels=c())
scale_color_discrete(name="")+
theme_lz_ppt()+theme(axis.text.y=element_text(size=12))+theme(panel.grid.major.y = element_line(color = "grey95"))+
labs(title="Tenured Faculty by Legal Sex and Racial Groups",x="",y="")
```


```{r tenured trend by sex, include=FALSE}
#pivot table
data%>% group_by(Year, `Legal Sex`,`Tenure Status`)%>%#2016 male as a group -> proportions of (non) tenure for all male professors in 2016
summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits=0))%>%filter(`Tenure Status`=="Tenure Line")%>%
#plot
ggplot(aes(color=factor(`Legal Sex`),x=factor(Year),y=prt,group=factor(`Legal Sex`)))+geom_line()+
geom_text_repel(aes(label=prt),fontface="bold",size=6.5)+
#themes
scale_y_continuous(breaks = seq(.3,.5,by=.1),labels = scales::percent)+
scale_color_discrete(name="")+
theme_lz_ppt()+theme(axis.text.y=element_blank())+
labs(title="Tenured Faculty by Legal Sex",x="",y="")
```

```{r tenure by sex, fig.width=6, include=FALSE}
data%>% filter(`Legal Sex`!="Unreported") %>% group_by(`Legal Sex`,`Tenure Status`)%>% summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits=0))%>%
ggplot(aes(fill=factor(`Tenure Status`),x=factor(`Legal Sex`),y=prt))+
geom_bar(stat = "identity",position = position_dodge())+
geom_text(aes(label=prt),position=position_dodge(.9),vjust=1.5,color="white",fontface="bold", size = 9)+theme_lz_ppt()+
scale_fill_discrete(labels=c("Non-tenure","Tenure"),name="")+
labs(x="",y="",title="Tenured Status by Legal Sex")
#Male faculty has 8% more tenured rate than female faculty.
```



::: notes
Faculty from two or more races has the highest tenured rate, 50%. Hispanic and White faculty have 39% tenured rate. Asian has 38%, African American has 36%, and International has the lowest 34% tenured rate.
::: 

```{r tenure-by-race}
#set order

race.order<-data%>%filter(`Race/Ethnicity`!=c ("Unreported",NA) )%>%

  group_by(`Race/Ethnicity`,`Tenure Status`)%>%summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits=0))%>%filter(`Tenure Status`=="Tenure Line")%>%arrange(prt)%>%mutate(race.f=factor(`Race/Ethnicity`))

data%>%filter(`Race/Ethnicity`!=c ("Unreported",NA) )%>%

  group_by(`Race/Ethnicity`,`Tenure Status`)%>%summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits=0))%>%

ggplot(aes(fill=factor(`Tenure Status`),y=factor(`Race/Ethnicity`),x=prt))+

  geom_bar(stat = "identity",position = position_dodge())+

  geom_text(aes(label=prt),position=position_dodge(.9),hjust=1,color="white",fontface="bold", size = 9)+theme_lz_ppt()+

  scale_fill_discrete(labels=c("Non-tenure","Tenure"),name="")+

  labs(x="",y="",title="Tenured Status by Racial Groups")+

  scale_y_discrete(limits=race.order$race.f)+

  theme(axis.text.x = element_blank(),axis.text.y = element_text(size = 20))
```


# Departmental Tenure Status

```{r top n dep, include=FALSE}
#Department that has top 6 number (unique ID/person) faculty

topdep<-data%>%group_by(Department)%>%summarise(cnt=n_distinct(ID))%>%arrange(-cnt)%>%head()

#check top department's T/NT

data%>%filter(Department %in% topdep[[1]]) %>%

  group_by(Department,`Tenure Status`)%>%

  summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits = 0))%>%arrange(-prt)

```

```{r dep groups, results='hide'}
#make department count as ndep

ndep<-data%>%group_by(Department)%>%summarise(cnt=n_distinct(ID))%>%arrange(-cnt)#

#four groups based on department count

ndep[ndep$cnt>30,]%>%str() #11 giant departments

ndep[ndep$cnt%in%seq(21,30,by=1),]%>%str() #13 large departments

ndep[ndep$cnt%in%seq(5,20,by=1),]%>%str()#14 medium departments

ndep[ndep$cnt<5,]%>%str()#14 small departments

ndep[ndep$cnt>20,]%>%str() #24 large departments

ndep[ndep$cnt>30,]%>%str() #11 giant departments

ndep[ndep$cnt%in%seq(21,30,by=1),]%>%str() #13 large departments

ndep[ndep$cnt%in%seq(5,20,by=1),]%>%str()#14 medium departments

ndep[ndep$cnt<5,]%>%str()#14 small departments

#order based on tenure prt -- exclude those without any tenure

dep.order.t<-data%>%group_by(Department,`Tenure Status`)%>%

  summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits = 0))%>%

  filter(`Tenure Status`=="Tenure Line")%>%arrange(prt)%>%

  mutate(dep.f=factor(Department))

#excluded in order

order.exclude<-data[( data$Department %in% dep.order.t$dep.f ) == FALSE,] %>%group_by(Department)%>%

  summarise(cnt=n_distinct(ID)) %>% arrange(cnt) %>% mutate(dep.xf=factor(Department))

dep.order<-c(order.exclude$dep.xf,dep.order.t$dep.f)
```

```{r dep n>20, fig.height=8}
#first group n>20, 24 large departments

data%>%filter(Department %in% ndep[ndep$cnt>20,1]$Department ) %>%

  group_by(Department,`Tenure Status`)%>%

  summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits = 0))%>%

  ggplot(aes(x=Department,y=prt,fill=`Tenure Status`))+geom_bar(stat = "identity")+

  scale_x_discrete(limits = dep.order[(dep.order %in% ndep[ndep$cnt>20,1]$Department)==TRUE])+

  theme_lz_ppt()+geom_text(aes(label=prt),position = position_stack(),hjust=1,color="white", size = 9)+

  coord_flip()+theme(axis.text.x = element_blank())+

  theme(axis.text.y=element_text(size = 20))+

  scale_fill_discrete(labels=c("Non-tenure","Tenure"),name="")+

  labs(x="",y="", title="Tenure for Large Departments (>20 faculty)")
```

```{r dep n>30}
#first group n>30, 11 giant departments

data%>%filter(Department %in% ndep[ndep$cnt>30,1]$Department ) %>%

  group_by(Department,`Tenure Status`)%>%

  summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits = 0))%>%

  ggplot(aes(x=Department,y=prt,fill=`Tenure Status`))+geom_bar(stat = "identity")+

  scale_x_discrete(limits = dep.order[(dep.order %in% ndep[ndep$cnt>30,1]$Department)==TRUE])+

  theme_lz_ppt()+geom_text(aes(label=prt),position = position_stack(),hjust=1,color="white", size = 9)+

  coord_flip()+theme(axis.text.x = element_blank())+

  theme(axis.text.y=element_text(size = 20))+

  scale_fill_discrete(labels=c("Non-tenure","Tenure"),name="")+

  labs(x="",y="", title="Tenure for Giant Departments (>30 faculty)")
```

```{r dep n21-30}
#13 large departments

data%>%filter(Department %in% ndep[ndep$cnt%in%seq(21,30,by=1),1]$Department ) %>%

  group_by(Department,`Tenure Status`)%>%

  summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits = 0))%>%

  ggplot(aes(x=Department,y=prt,fill=`Tenure Status`))+geom_bar(stat = "identity")+

  scale_x_discrete(limits = dep.order[dep.order %in% 

                                              ndep[ndep$cnt%in%seq(21,30,by=1),1]$Department 

                                            ])+

  theme_lz_ppt()+geom_text(aes(label=prt),position = position_stack(),hjust=1, color="white", size = 9)+

  coord_flip()+theme(axis.text.x = element_blank())+

  theme(axis.text.y=element_text(size = 20))+

  labs(x="",y="",title=str_wrap("Tenure for Large Departments (21-30 faculty)",35))
```

```{r dep n5-20}
#22 medium departments

data%>%filter(Department %in% ndep[ndep$cnt%in%seq(5,20,by=1),1]$Department ) %>%

  group_by(Department,`Tenure Status`)%>%

  summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits = 0))%>%

  ggplot(aes(x=Department,y=prt,fill=`Tenure Status`))+geom_bar(stat = "identity")+

  scale_x_discrete(limits = dep.order[dep.order %in% 

                                              ndep[ndep$cnt%in%seq(5,20,by=1),1]$Department 

                                            ])+

  theme_lz_ppt()+geom_text(aes(label=prt),position = position_stack(),hjust=1, color="white", size = 9)+

  coord_flip()+theme(axis.text.x = element_blank())+

  theme(axis.text.y=element_text(size = 20))+

  labs(x="",y="",title=str_wrap("Tenure for Medium-size Departments (5-20 faculty)",35))
```

```{r n<5}
#14 medium departments

data%>%filter(Department %in% ndep[ndep$cnt<5,1]$Department ) %>%

  group_by(Department,`Tenure Status`)%>%

  summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits = 0))%>%

  ggplot(aes(x=Department,y=prt,fill=`Tenure Status`))+geom_bar(stat = "identity")+

  scale_x_discrete(limits = dep.order[dep.order %in% 

                                              ndep[ndep$cnt<5,1]$Department 

                                            ])+

  theme_lz_ppt()+geom_text(aes(label=prt),position = position_stack(),hjust=1, color="white", size = 9)+

  coord_flip()+theme(axis.text.x = element_blank())+

  theme(axis.text.y=element_text(size = 20))+

  labs(x="",y="",title=str_wrap("Tenure for Medium-size Departments (<5 faculty)",35))
```
