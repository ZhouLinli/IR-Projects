---
title: "Review Core Curriculum"
author: ""
date: ""
output: 
  word_document:
    reference_docx: /Users/linlizhou/Documents/Rprojects/lasell.report.IN-USE.docx
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("/Users/linlizhou/Documents/Rprojects/IR-Projects/theme_source.R") #run code from saved theme and library
```




#Reporting Items

1. DONE-For each term (fall/spring): # courses/ sections offered in each core segment -- SECTION TALLY
2. DONE-For each term (fall/spring): # registration in each core segment -- SECTION TALLY 

3. DONE- % of pass, C or better, and Withdrawal; Average GPA (and SD) of each courses -- STU INFO BY COURSE
4. DONE-All core course enrollment and transfer proportion -- deduplicated student count in STU INFO BY COURSE

5. DONE/HIDE-All core course retention -- STARFISH RETENTION REPORT
6. DONE-Satisfaction -- 2018-2022 4 years of satisfaction prt in that one question containing "core"
6. DONE-course-taking sequence -- 2018 COHORT BY GRADUATION IN 2022 OR NOT -- POWERCAMPUS TRANSCRIPT

#Overview of data frames in this analysis

1. section offered and num of enrollment
sectiontally: coursecode, CourseGroup, Current_Enrollment

2. GPA
stucrs: coursecode, CourseGroup, Final_Grade
stucrs.grades: Final_Grade(filtered only valid-grade rows), grade (group C or better, and D), GPA (convert Final_Grade to numeric)

3. 2018 cohort
Corepath.ls: ppid, term, CourseGroup
Corepath: Writing: Capstone (term vectors for each row), ppid, matric

4.AAC
aac.crs (aac coursecode from stucrs): term,coursecode, Semester_GPA, Cumulative_GPA

# Core Course List

```{r list of core courses}
corelist<-tibble(CourseCode=c("WRT101", "WRT102","ENG101","ENG102","MATH106", "MATH107", "MATH116", "MATH202", "MATH203", "MATH203", "MATH205", "MATH208", "MATH209", "FYS103", "HON101", "MDSC203", "HON205", "PHIL302", "ARTH107", "ARTS106", "ARTS126", "ARTS205", "ENG210", "ENG217", "ENG218", "ENG225", "MUS101", "MUS102", "MUS109", "MUS203", "PERF107", "PERF111", "PERF202", "PERF203", "HIST104", "SOC104", "ANTH101", "CJ101", "COM103", "ENV101", "LS101", "PSYC101", "SOC101", "SOC102", "BIO101", "BIO102", "BIO107", "BIO113", "CHEM105", "CHEM203", "ENV206", "ENV211", "ENV220", "MATH109", "PHYS111", "PHYS112", "SCI103", "SCI104", "SCI105", "SCI106", "SCI107", "SCI114", "SCI115", "SCI117", "SCI118", "SCI119", "BIO420", "BUSS497", "CHEM407", "COM400", "CJ443", "CJ444", "DSCI499", "ED496", "ED498", "ED482", "ED484", "ED427", "EXSC410", "EXSC425", "FASH415", "FSCI407", "GRAP400", "HS415", "HS425", "HUM400", "LS443", "LS444", "BIO430", "BUSS440", "CJ441", "CJ442", "COM495", "DSCI409", "ED494", "ENG402", "EXSC430", "FASH427", "FSCI480", "GLBS401", "GRAP404", "HIST401", "HS427", "HUM419", "HUM420", "LS441", "LS442", "MATH399")) %>%
mutate(CourseGroup=case_when(CourseCode%in%c("WRT101", "WRT102","ENG101","ENG102") ~"Writing", 
CourseCode%in%c("MATH106", "MATH107", "MATH116", "MATH202", "MATH203", "MATH203", "MATH205", "MATH208", "MATH209") ~"Math", 
CourseCode%in%c("FYS103", "HON101")  ~ "FYS", 
CourseCode%in%c("MDSC203", "HON205")  ~ "Multidisciplinary", 
CourseCode%in%c("PHIL302")  ~ "PHIL302", 
CourseCode%in%c("ARTH107", "ARTS106", "ARTS126", "ARTS205", "ENG210", "ENG217", "ENG218", "ENG225", "MUS101", "MUS102", "MUS109", "MUS203", "PERF107", "PERF111", "PERF202", "PERF203")  ~ "Aesthetics & Creativity", 
CourseCode%in%c("HIST104")  ~ "Global & Historical", 
CourseCode%in%c("SOC104", "ANTH101", "CJ101", "COM103", "ENV101", "LS101", "PSYC101", "SOC101", "SOC102")  ~ "Individuals & Society", 
CourseCode%in%c("BIO101", "BIO102", "BIO107", "BIO113", "CHEM105", "CHEM203", "ENV206", "ENV211", "ENV220", "MATH109", "PHYS111", "PHYS112", "SCI103", "SCI104", "SCI105", "SCI106", "SCI107", "SCI114", "SCI115", "SCI117", "SCI118", "SCI119")  ~ "Scientific Inquiry & Problem Solving",
CourseCode%in%c("BIO420", "BUSS497", "CHEM407", "COM400", "CJ443", "CJ444", "DSCI499", "ED496", "ED498", "ED482", "ED484", "ED427", "EXSC410", "EXSC425", "FASH415", "FSCI407", "GRAP400", "HS415", "HS425", "HUM400", "LS443", "LS444")  ~ "Internship", 
CourseCode%in%c("BIO430", "BUSS440", "CJ441", "CJ442", "COM495", "DSCI409", "ED494", "ENG402", "EXSC430", "FASH427", "FSCI480", "GLBS401", "GRAP404", "HIST401", "HS427", "HUM419", "HUM420", "LS441", "LS442", "MATH399")  ~ "Capstone"))

#Scientific Inquiry & Problem Solving KP
#sectiontally%>%filter(grepl("^SCI|^BIO|^CHEM|^ENV|^MATH|^PHYS", event_id), 
#                      grepl("KP$", section)) %>%count(event_id)
#added the last few; and removed:  "SCI117", "SCI118", "SCI119", "MATH109", "SCI107"  in Scientific Inquiry & Problem Solving KP
```

# Section Tally dataset

```{r load crs data}
#download section tally for 2018 Fall, 2019 Spring, 2019 Fall, 2020 Spring, 2020 Fall, 2021 Spring, 2021 Fall, 2022 Spring
# var needed: coursecodes, sectiontimes, student enrollment, student grades

fa18.sec<-read_csv("/Volumes/lasellshare/Faculty_Staff_Shares$/IR/Data and Analyses/Program Review/2022 Core Curriculum/data files/Section Tally18fall.csv", skip = 2)%>%mutate(term="2018 Fall")
sp19.sec<-read_csv("/Volumes/lasellshare/Faculty_Staff_Shares$/IR/Data and Analyses/Program Review/2022 Core Curriculum/data files/Section Tally19sp.csv", skip = 2)%>%mutate(term="2019 Spring")
  
fa19.sec<-read_csv("/Volumes/lasellshare/Faculty_Staff_Shares$/IR/Data and Analyses/Program Review/2022 Core Curriculum/data files/Section Tally19fall.csv", skip = 2)%>%mutate(term="2019 Fall")
sp20.sec<-read_csv("/Volumes/lasellshare/Faculty_Staff_Shares$/IR/Data and Analyses/Program Review/2022 Core Curriculum/data files/Section Tally20sp.csv", skip = 2)%>%mutate(term="2020 Spring")

fa20.sec<-read_csv("/Volumes/lasellshare/Faculty_Staff_Shares$/IR/Data and Analyses/Program Review/2022 Core Curriculum/data files/Section Tally20fall.csv", skip = 2)%>%mutate(term="2020 Fall")
sp21.sec<-read_csv("/Volumes/lasellshare/Faculty_Staff_Shares$/IR/Data and Analyses/Program Review/2022 Core Curriculum/data files/Section Tally21sp.csv", skip = 2)%>%mutate(term="2021 Spring")

fa21.sec<-read_csv("/Volumes/lasellshare/Faculty_Staff_Shares$/IR/Data and Analyses/Program Review/2022 Core Curriculum/data files/Section Tally21fall.csv", skip = 2)%>%mutate(term="2021 Fall")
sp22.sec<-read_csv("/Volumes/lasellshare/Faculty_Staff_Shares$/IR/Data and Analyses/Program Review/2022 Core Curriculum/data files/Section Tally22sp.csv", skip = 2)%>%mutate(term="2022 Spring")

#merge
sectiontally<-plyr::join_all(list(fa18.sec, sp19.sec, fa19.sec, sp20.sec, fa20.sec, sp21.sec, fa21.sec, sp22.sec), type="full")#6246 rows

#exclude suffix in event_id: extract any number of LETTER followed by any number of NUMBER 
sectiontally<-sectiontally%>%mutate(coursecode=str_extract(event_id,"[A-Z]+[0-9]+"))#check: %>%count(coursecode)

#only keep core courses
sectiontally<-sectiontally%>%filter(sectiontally$coursecode %in% corelist$CourseCode)%>%unique()#check: %>%count(coursecode)#1338 rows

#add segment/coursegroup names col
sectiontally<-left_join(sectiontally,corelist, by=c("coursecode"="CourseCode"))%>%unique()#1338 rows

#remove invalid section (enrollment>0)
sectiontally<-sectiontally%>%filter(Current_Enrollment>0)

#factorize coursegroup for convinience showing
sectiontally<-sectiontally%>%mutate(CourseGroup=factor(CourseGroup,levels = c("Writing","Math","FYS","Multidisciplinary","PHIL302","Aesthetics & Creativity","Global & Historical","Individuals & Society","Scientific Inquiry & Problem Solving","Internship","Capstone")))

#factorize term for convinience showing
sectiontally<-sectiontally%>%mutate(term=factor(term,levels = c("2018 Fall","2019 Spring","2019 Fall","2020 Spring","2020 Fall","2021 Spring","2021 Fall","2022 Spring")))

#save: write_xlsx(sectiontally,"/Volumes/lasellshare/Faculty_Staff_Shares$/IR/Data and Analyses/Program Review/2022 Core Curriculum/data files/Section Tally_18FA-22SP_Core Curriculum.xlsx")
#check course and section combination is unique: sectiontally%>%count(coursecode,section,class_time,instructor,course_start_date,event_long_name)%>%filter(n>1)
```


```{r sectiont tally - number of section offered}
#For each term (fall/spring): # courses/ sections offered in each core segment -- SECTION TALLY

#number of total section offered
#sectiontally%>%group_by(CourseGroup)%>%summarise(section_n=n())

#number of term section offered
sectiontally%>%group_by(CourseGroup,term)%>%summarise(section_n=n())%>%
  pivot_wider(names_from = term, values_from = section_n)%>%
  #reorder cols
  select(CourseGroup,`2018 Fall`,`2019 Spring`,`2019 Fall`,`2020 Spring`,`2020 Fall`,`2021 Spring`,`2021 Fall`,`2022 Spring`)%>%
  View()

#investigate why no 2018fall 2019 spring data for writing?
#sectiontally%>%filter(coursecode%in%c("WRT101", "WRT102"))%>%count(term,coursecode)


#number of course offered:how many times a group appear when matching with unique coursecodes
#sectiontally%>%count(CourseGroup,coursecode)%>%count(CourseGroup)
#the Same: sectiontally%>%count(CourseGroup,term,coursecode)%>%count(term,CourseGroup)#how many times a group appear when matching with unique coursecodes
```


```{r sectiont tally - number of registration}
# For each term (fall/spring): # registration in each core segment -- SECTION TALLY 
sectiontally%>%group_by(CourseGroup,term)%>%summarise(enrollment=sum(Current_Enrollment))%>%
  pivot_wider(names_from = term, values_from = enrollment)%>%
  #reorder cols
  select(CourseGroup,`2018 Fall`,`2019 Spring`,`2019 Fall`,`2020 Spring`,`2020 Fall`,`2021 Spring`,`2021 Fall`,`2022 Spring`)%>%
  View()
```

```{r solve NA problem in WRI in 18fall/19}
#since we have NA section for WRI101/102 in 18fall/19spring, we investigated the raw data
sp19.sec%>%#filter(term=="2018 Fall")%>%
  #count(coursecode,event_long_name)
  filter(str_detect(event_long_name,"Writing"))%>%count(event_long_name,event_id)
#found ENG101/102 as writing course too -- edited corecourse list and everything else updated done
```



# Student Info by Course dataset

```{r load student data}
# download stu info by course for 18-19, 19-20, 20-21, 21-22
# var needed: core course students' transfer status, unduplicated total enroll
crs18_19<-read_csv("/Volumes/lasellshare/Faculty_Staff_Shares$/IR/Data and Analyses/Program Review/2022 Core Curriculum/data files/Student Info by Course and Fiscal Year18-19.csv")
crs19_20<-read_csv("/Volumes/lasellshare/Faculty_Staff_Shares$/IR/Data and Analyses/Program Review/2022 Core Curriculum/data files/Student Info by Course and Fiscal Year19-20.csv")
crs20_21<-read_csv("/Volumes/lasellshare/Faculty_Staff_Shares$/IR/Data and Analyses/Program Review/2022 Core Curriculum/data files/Student Info by Course and Fiscal Year20-21.csv")
crs21_22<-read_csv("/Volumes/lasellshare/Faculty_Staff_Shares$/IR/Data and Analyses/Program Review/2022 Core Curriculum/data files/Student Info by Course and Fiscal Year21-22.csv")
#merge
stucrs<-plyr::join_all(list(crs18_19,crs19_20,crs20_21,crs21_22), type="full")#110588 rows

#only fall-spring term
stucrs<-stucrs%>%filter(academic_term%in%c("FALL","SPRING"))#101559

#exclude suffix in Course_ID: extract any number of LETTER followed by any number of NUMBER 
stucrs<-stucrs%>%mutate(coursecode=str_extract(Course_ID,"[A-Z]+[0-9]+"))#check: %>%count(coursecode)

#only keep core courses
stucrs<-stucrs%>%filter(stucrs$coursecode %in% corelist$CourseCode)%>%unique()#check: %>%count(coursecode)#29424 rows

#add segment/coursegroup names col
stucrs<-left_join(stucrs,corelist, by=c("coursecode"="CourseCode"))%>%unique()#29424 rows



#factorize coursegroup for convinience showing
stucrs<-stucrs%>%mutate(CourseGroup=factor(CourseGroup,levels = c("Writing","Math","FYS","Multidisciplinary","PHIL302","Aesthetics & Creativity","Global & Historical","Individuals & Society","Scientific Inquiry & Problem Solving","Internship","Capstone")))

#mutate and factorize term for convinience showing
stucrs<-stucrs%>%mutate(term=paste(academic_year,academic_term,sep=" "),
                        term=factor(term,levels = c("2018 FALL","2019 SPRING","2019 FALL","2020 SPRING","2020 FALL","2021 SPRING","2021 FALL","2022 SPRING")))
```

# Unduplicated student taking core courses

```{r deduplicated student count by term}
stucrs%>%group_by(term)%>%summarise(n=n_distinct(people_code_id))%>%
#%>%select(n)%>%colSums(n)#10549 ppid adding separate terms together
  pivot_wider(names_from = term,values_from = n)%>%View()
```


```{r unduplicated student list for transfer status}
#unduplicated student list: distinctive ppid for each term
stucrs.id<-stucrs%>%group_by(term)%>%distinct(people_code_id)%>%unique()
#unqiue now: stucrs.id%>%count(term,people_code_id)


#transfer status in dtm
dmt<-read_excel("/Volumes/lasellshare/Faculty_Staff_Shares$/IR/Datamart Files/DataMart To Date/Final Datamart up to Date 09262022.xlsx")
dmt.transfer<-dmt%>%select(PC_ID,TRANSFER_YN)
#merge
stucrs.id<-left_join(stucrs.id,dmt.transfer,by=c("people_code_id"="PC_ID"))
#not unique now: stucrs.id%>%count(term,people_code_id)

#once transfer then transfer
y<-stucrs.id%>%mutate(transfer=case_when(TRANSFER_YN=="Y"~TRANSFER_YN, TRANSFER_YN!="Y"~"N"))%>%select(people_code_id,transfer)%>%unique()%>%arrange(people_code_id)%>%filter(transfer =="Y")#keep any A values of new col
n<-stucrs.id%>%filter(! people_code_id%in% y$people_code_id)%>%mutate(transfer ="N")%>%select(people_code_id,transfer)%>%unique()%>%arrange(people_code_id)##for ppid not settled with y will be notA

#merge settled in y and n; #attach back (using transfer) to the original dataset
yn<-full_join(y,n) #check: indeed one time appearance: yn%>%count(people_code_id)%>%count(n)
stucrs.id<-left_join(stucrs.id,yn)%>%select(-TRANSFER_YN)%>% unique()%>%arrange(people_code_id)#remove used TRANSFER_YN (used transfer replace var)
#once again unique: stucrs.id%>%count(term,people_code_id)%>%count(n)

#transfer status percent
stucrs.id%>%group_by(term,transfer)%>%summarise(cnt=n())%>%
  mutate(prt=formattable::percent(cnt/sum(cnt),digits = 0))%>%
  filter(transfer=="Y")%>%select(term,prt)%>%
  pivot_wider(names_from = term, values_from = prt)%>%View()
```

```{r retention}
fa18<-stucrs.id%>%filter(term=="2018 FALL")
sp19<-stucrs.id%>%filter(term=="2019 SPRING")
fa19<-stucrs.id%>%filter(term=="2019 FALL")
sp20<-stucrs.id%>%filter(term=="2020 SPRING")
fa20<-stucrs.id%>%filter(term=="2020 FALL")
sp21<-stucrs.id%>%filter(term=="2021 SPRING")
fa21<-stucrs.id%>%filter(term=="2021 FALL")
sp22<-stucrs.id%>%filter(term=="2022 SPRING")

#term to term retention
ret18fa<-summary(fa18$people_code_id%in%sp19$people_code_id)%>%
  as.array()%>%as.data.frame()%>%filter(Var1!="Mode")%>%
  mutate(ret=as.numeric(Freq[2])/ (as.numeric(Freq[1])+as.numeric(Freq[2])))%>%
  select(ret)%>%unique()

ret19sp<-summary(sp19$people_code_id%in%fa19$people_code_id)%>%
  as.array()%>%as.data.frame()%>%filter(Var1!="Mode")%>%
  mutate(ret=as.numeric(Freq[2])/ (as.numeric(Freq[1])+as.numeric(Freq[2])))%>%
  select(ret)%>%unique()

ret19fa<-summary(fa19$people_code_id%in%sp20$people_code_id)%>%
  as.array()%>%as.data.frame()%>%filter(Var1!="Mode")%>%
  mutate(ret=as.numeric(Freq[2])/ (as.numeric(Freq[1])+as.numeric(Freq[2])))%>%
  select(ret)%>%unique()

ret20sp<-summary(sp20$people_code_id%in%fa20$people_code_id)%>%
  as.array()%>%as.data.frame()%>%filter(Var1!="Mode")%>%
  mutate(ret=as.numeric(Freq[2])/ (as.numeric(Freq[1])+as.numeric(Freq[2])))%>%
  select(ret)%>%unique()

ret20fa<-summary(fa20$people_code_id%in%sp21$people_code_id)%>%
  as.array()%>%as.data.frame()%>%filter(Var1!="Mode")%>%
  mutate(ret=as.numeric(Freq[2])/ (as.numeric(Freq[1])+as.numeric(Freq[2])))%>%
  select(ret)%>%unique()

ret21sp<-summary(sp21$people_code_id%in%fa21$people_code_id)%>%
  as.array()%>%as.data.frame()%>%filter(Var1!="Mode")%>%
  mutate(ret=as.numeric(Freq[2])/ (as.numeric(Freq[1])+as.numeric(Freq[2])))%>%
  select(ret)%>%unique()

ret21fa<-summary(fa21$people_code_id%in%sp22$people_code_id)%>%
  as.array()%>%as.data.frame()%>%filter(Var1!="Mode")%>%
  mutate(ret=as.numeric(Freq[2])/ (as.numeric(Freq[1])+as.numeric(Freq[2])))%>%
  select(ret)%>%unique()

#attach together
tibble(term=c("2018 FALL","2019 SPRING","2019 FALL","2020 SPRING","2020 FALL","2021 SPRING","2021 FALL"),
       retention=c(ret18fa,ret19sp,ret19fa,ret20sp,ret20fa,ret21sp,ret21fa))%>%
  mutate(retention=formattable::percent(retention,digits = 0))%>%
  pivot_wider(names_from = term, values_from = retention)%>%
  View()
```



# stucrs.grade: Valid grade filtered

```{r clean stucrs.grade}
#check course and section combination is unique: 
stucrs%>%count(people_code_id,coursecode,Course_section,Course_Name,Instructor_ids,Add_Drop, term)%>%filter(n>1)#appeared twice
#check one of those twice appearance: stucrs%>%filter(people_code_id=="P000053284",coursecode=="CHEM203",Course_section=="B",term=="2019 FALL")
##it's due to two different final grades (one for lab)

#investigate final grades:
stucrs%>%count(Final_Grade)
#clean final grades
stucrs.grade<-stucrs%>%filter(Final_Grade%in%c("F", "W", "A", "A-", "B+", "B", "B-", "C+", "C", "P",
                                               "D","D+","D-"))%>%
#regroup
  mutate(grade=if_else(Final_Grade%in%c("A", "A-", "B+", "B", "B-", "C+", "C", "P"), "C or better",
                       if_else(Final_Grade%in%c("D","D+","D-"),"D",Final_Grade)),
#convert
        GPA=case_when(Final_Grade=="F"~"0",Final_Grade=="A"~"4.0",Final_Grade=="A-"~"3.7",
                      Final_Grade=="B+"~"3.3",Final_Grade=="B"~"3",Final_Grade=="B-"~"2.7",
                      Final_Grade=="C+"~"2.3",Final_Grade=="C"~"2",Final_Grade=="C-"~"1.7",
                      Final_Grade=="D+"~"1.3",Final_Grade=="D"~"1",Final_Grade=="D-"~"0.7"),
        GPA=as.numeric(GPA))
#save: write_xlsx(stucrs.grade,"/Volumes/lasellshare/Faculty_Staff_Shares$/IR/Data and Analyses/Program Review/2022 Core Curriculum/data files/StudentInfoCourse_18FA-22SP_Core Curriculum.xlsx")
```


```{r report C/Pass/Withdraw}
# % of C or better (A, A-, B+, B, B-, C+, C or P)
# % of pass (not F or W) for each segment
# % of Withdrawal (W)
stucrs.grade%>%group_by(term,grade)%>%summarise(cnt=n())%>%
  mutate(prt=formattable::percent(cnt/sum(cnt),digits = 0))%>%
  select(-cnt)%>%pivot_wider(names_from = term,values_from = prt)%>%View()

# by segment/coursegroup

##figuring out how to order vars in group by:
#stucrs.grade%>%filter(term=="2018 FALL")%>%
#  group_by(CourseGroup,grade)%>%summarise(cnt=n())%>%
#  mutate(prt=formattable::percent(cnt/sum(cnt),digits = 0))%>%
#  select(-cnt)%>%pivot_wider(names_from = grade,values_from = prt)%>%View()

##OVERALL
stucrs.grade%>%
  group_by(term,CourseGroup,grade)%>%summarise(cnt=n())%>%
  mutate(prt=formattable::percent(cnt/sum(cnt),digits = 0))%>%
  select(-cnt)%>%pivot_wider(names_from = term,values_from = prt)%>%
  View()

#C or better by coursegroup
stucrs.grade%>%
  group_by(term,CourseGroup,grade)%>%summarise(cnt=n())%>%
  mutate(prt=formattable::percent(cnt/sum(cnt),digits = 0))%>%
  filter(grade%in%c("C or better"))%>%
  select(-cnt)%>%pivot_wider(names_from = grade, values_from = prt)%>%
  pivot_wider(names_from = term,values_from = `C or better`)%>%
  View()

#pass
stucrs.grade%>%
  group_by(term,CourseGroup,grade)%>%summarise(cnt=n())%>%
  #mutate(prt=formattable::percent(cnt/sum(cnt),digits = 0))%>%
  mutate(prt=cnt/sum(cnt))%>%
  filter(grade%in%c("C or better","D"))%>%
  select(-cnt)%>%pivot_wider(names_from = grade, values_from = prt)%>%
  replace(is.na(.), 0)%>%
  mutate(pass=`C or better`+D)%>%select(-`C or better`,-D)%>%
  mutate(pass=formattable::percent(pass,digits = 0))%>%
  pivot_wider(names_from = term,values_from = pass)%>%
  View()

#withdrawl by coursegroup
stucrs.grade%>%
  group_by(term,CourseGroup,grade)%>%summarise(cnt=n())%>%
  #mutate(prt=formattable::percent(cnt/sum(cnt),digits = 0))%>%
  mutate(prt=cnt/sum(cnt))%>%filter(grade=="W")%>%
  replace(is.na(.), 0)%>%#actually prt have no NA values
  select(-cnt)%>%pivot_wider(names_from = term,values_from = prt)%>%#it is after pivotwider that some terms do not have a value (i.e. have NA)
 # replace(is.na(.), 0)%>%#actually prt have no NA values
  View()
```


```{r report GPA}
# Average GPA (and SD): 
stucrs.grade%>%group_by(term)%>%summarise(mn=round(mean(GPA,na.rm=T),digits = 2),
                                          sd=round(sd(GPA,na.rm=T),digits = 2))%>%View()#tanspose when paste
#GPA by segment/coursegroup
stucrs.grade%>%group_by(term,CourseGroup)%>%summarise(mn=round(mean(GPA,na.rm=T),digits = 2))%>%
  pivot_wider(names_from = term,values_from = mn)%>%
  View()
```


```{r focus on FYS/SciInq}
#In grade table, FYS in spring and SciInq in fall has weried pattern of being sig. lower. To investigate what are the most at-risk courses: 
#lay out all FYS/SciInq courses by term (fall vs spring) w/t % pass

#stucrs.grade%>%count(CourseGroup)
#FYS
stucrs.grade%>%filter(CourseGroup%in%c("FYS"))%>%
  group_by(term,coursecode,grade)%>%summarise(cnt=n())%>%
  #mutate(prt=formattable::percent(cnt/sum(cnt),digits = 0))%>%
  mutate(prt=cnt/sum(cnt))%>%
  filter(grade%in%c("C or better","D"))%>%
  select(-cnt)%>%pivot_wider(names_from = grade, values_from = prt)%>%
  replace(is.na(.), 0)%>%
  mutate(pass=`C or better`+D)%>%select(-`C or better`,-D)%>%
  mutate(pass=formattable::percent(pass,digits = 0))%>%
  pivot_wider(names_from = term,values_from = pass)%>%
  View()

#SciInq
stucrs.grade%>%filter(CourseGroup%in%c("Scientific Inquiry & Problem Solving"))%>%
  group_by(term,coursecode,grade)%>%summarise(cnt=n())%>%
  #mutate(prt=formattable::percent(cnt/sum(cnt),digits = 0))%>%
  mutate(prt=cnt/sum(cnt))%>%
  filter(grade%in%c("C or better","D"))%>%
  select(-cnt)%>%pivot_wider(names_from = grade, values_from = prt)%>%
  replace(is.na(.), 0)%>%
  mutate(pass=`C or better`+D)%>%select(-`C or better`,-D)%>%
  mutate(pass=formattable::percent(pass,digits = 0))%>%
  pivot_wider(names_from = term,values_from = pass)%>%
  View()
```

# PATH of taking core courses

```{r corepath.ls df}
#check: stucrs%>%count(CourseGroup); stucrs%>%count(term)

#only those from 2018 cohort: which semester they take certain course
corepath.ls<-stucrs%>%filter(cohort_id=="2018")%>%
  #relevant vars: who (background matched later using ppid) take which coursegroup & when
  select(people_code_id,term,CourseGroup)%>%
  #colapse the Same person taking the Same coursegroup (at the Same term) into one row
  unique()%>%
  #recode termfor easier readability
  mutate(term=case_when(term=="2018 FALL"~1,term=="2019 SPRING"~2,term=="2019 FALL"~3,term=="2020 SPRING"~4,
    term=="2020 FALL"~5,term=="2021 SPRING"~6,term=="2021 FALL"~7,term=="2022 SPRING"~8))

#corepath%>%group_by(people_code_id)%>%summarise(term=Kmisc::paste_na(math.term, wri.term, FYS.term, multid.term, phil.term, aesCre.term, globalHis.term, indSoc.term, sciInq.term,sep = ""))
```


```{r corepath df}
#each course, what terms
corepath<-corepath.ls%>%group_by(people_code_id,CourseGroup)%>%count(term)%>%select(-n)%>%
#approach 1-manual copy paste from pivot wider output
  pivot_wider(names_from = CourseGroup,values_from = term)%>%#%>%View()#united term together as vector; but need to manually copy View() to excel output
#approach 2-based on approach 1, convert list-col to string so that can auto export as normal cell into excel
  mutate(across(Writing:Internship, function(x) sapply(x, toString)))
#shorten from: mutate(Writing = sapply(Writing, toString),...)

#check for n-per-key is unique: corepath.s%>%count(people_code_id)%>%filter(n>1)

#merge more background vars
corepath<-left_join(corepath,dmt[c("PC_ID","GRADUATED_YN")],by=c("people_code_id"="PC_ID"))

#any of the term is “1” then they are
y<-corepath%>%mutate(matric=case_when(GRADUATED_YN=="Y"~"Graduated",GRADUATED_YN!="Y"~"Not Graduate"))%>%
  select(people_code_id,matric)%>%unique()%>%arrange(people_code_id)%>%filter(matric =="Graduated")#keep any grad values of new col
n<-corepath%>%filter(! people_code_id%in% y$people_code_id)%>% #for people_code_id with not settled
  mutate(matric="Not Graduate")%>%#all not settled with y will be not grad
  select(people_code_id,matric)%>%unique()%>%arrange(people_code_id)
#merge settled in y and n
matric.df<-full_join(y,n)
#attach back (using matric) to the original dataset
corepath<-left_join(corepath,matric.df)%>%
  select(-GRADUATED_YN)%>% unique()%>%arrange(people_code_id)#remove used GRADUATED_YN (used matric replace GRADUATED_YN)

#write_xlsx(corepath,"/Volumes/lasellshare/Faculty_Staff_Shares$/IR/Data and Analyses/Program Review/2022 Core Curriculum/path_2018cohort.xlsx")
##AFTER EXPORT TO EXCEL: I did conditional formatting for term 1-8, each cell that contains a term ("1") has a different color (1-4 is ascending blue, 5-8 is ascending green)
```


```{r report prt of term for coursegroup}
#OVERALL - each coursegroup, prt of each term
#approach 1- need to manually replace NA with 0 (cannot use replace in formattable % format)
#corepath.ls%>%group_by(CourseGroup,term)%>%summarise(cnt=n())%>%
#  mutate(prt=formattable::percent(cnt/sum(cnt),digits = 1))%>%
#  select(-cnt)%>%pivot_wider(names_from = CourseGroup, values_from = prt)%>%View()
#approach 2- decimal points
corepath.ls%>%group_by(CourseGroup,term)%>%summarise(cnt=n())%>%
  mutate(prt=round(cnt/sum(cnt),digits = 3))%>%
  select(-cnt)%>%pivot_wider(names_from = CourseGroup, values_from = prt)%>%
  replace(is.na(.), 0)%>%#mutate(across(Writing:Capstone,funs(paste0(.* 100, "%"))))#failed to convert to %
  View()


#graduated vs not graduated students
#merge matrix status
corepath.ls<-left_join(corepath.ls,corepath[c("people_code_id","matric")])
#graduated
corepath.ls%>%filter(matric=="Graduated")%>%
  group_by(CourseGroup,term)%>%summarise(cnt=n())%>%
  mutate(prt=round(cnt/sum(cnt),digits = 3))%>%
  select(-cnt)%>%pivot_wider(names_from = CourseGroup, values_from = prt)%>%
  replace(is.na(.), 0)%>%#mutate(across(Writing:Capstone,funs(paste0(.* 100, "%"))))#failed to convert to %
  View()
#not graduated
corepath.ls%>%filter(matric=="Not Graduate")%>%
  group_by(CourseGroup,term)%>%summarise(cnt=n())%>%
  mutate(prt=round(cnt/sum(cnt),digits = 3))%>%
  select(-cnt)%>%pivot_wider(names_from = CourseGroup, values_from = prt)%>%
  replace(is.na(.), 0)%>%#mutate(across(Writing:Capstone,funs(paste0(.* 100, "%"))))#failed to convert to %
  View()
#AFTER COPY PASTE IN EXCEL: 1. I calculated the difference between grad vs not graduated - hilight high prt to show popular terms for each courses. 2. Used conditional formmatting for difference>0.1 or <-0.1 
# in the path itself: I removed anything after the first course (i.e., for 1,2,3 meaning student aking the course in the 1st, 2nd, and 3rd semester, I only keep the 1st semester -- due to the definition of core course is the first course that student take in that course category)
```





# AAC 102, 103, 104: Semester/Cumulative_GPA

```{r aac.crs df created}
#merge crs from 5 years and create aac.crs
aac.crs<-plyr::join_all(list(crs18_19,crs19_20,crs20_21,crs21_22), type="full")%>%
#only fall-spring term
filter(academic_term%in%c("FALL","SPRING"))%>%
#exclude suffix in Course_ID: extract any number of LETTER followed by any number of NUMBER 
mutate(coursecode=str_extract(Course_ID,"[A-Z]+[0-9]+"))%>%#check: %>%count(coursecode)
#only keep AAC courses
filter(coursecode %in% c("AAC102","AAC103","AAC104"))%>%unique()#check: %>%count(coursecode)

#factorize term for convinience showing
aac.crs<-aac.crs%>%mutate(coursecode=factor(coursecode,levels = c("AAC102","AAC103","AAC104")),
term=paste(academic_year,academic_term,sep=" "),
term=factor(term,levels = c("2018 FALL","2019 SPRING","2019 FALL","2020 SPRING","2020 FALL","2021 SPRING","2021 FALL","2022 SPRING")))

#save: write_xlsx(stucrs.grade,"/Volumes/lasellshare/Faculty_Staff_Shares$/IR/Data and Analyses/Program Review/2022 AAC/StudentInfoCourse_18FA-22SP_aac10234.xlsx")
```


```{r unduplicated enrollment}
aac.crs%>%group_by(term,coursecode)%>%summarise(n=n_distinct(people_code_id))%>%
#%>%select(n)%>%colSums(n)#10549 ppid adding separate terms together
  pivot_wider(names_from = term,values_from = n)%>%View()
```


```{r pass vs fail}
#add category var (pass vs fail of aac course)
aac.crs<-aac.crs%>%mutate(passfail=case_when(Final_Grade%in%c("A","P")~"Pass",
                                    Final_Grade=="F"~"Fail"))#check:%>%count(passfail)

# report prt students pass
aac.crs%>%group_by(term,coursecode,passfail)%>%summarise(cnt=n())%>%
  mutate(prt=formattable::percent(cnt/sum(cnt),digits = 0))%>%
  filter(passfail%in%c("Pass"))%>%
  select(-cnt)%>%pivot_wider(names_from = passfail, values_from = prt)%>%
  pivot_wider(names_from = term,values_from = Pass)%>%
  View()
```

```{r pass vs fail by mean semester GPA}
#PASSED students' mean semester GPA
aac.crs%>%group_by(term,coursecode,passfail)%>%
  summarise(mn=round(mean(Semester_GPA,na.rm=TRUE),digits=1))%>%
  filter(passfail%in%c("Pass"))%>%
  pivot_wider(names_from = passfail, values_from = mn)%>%
  pivot_wider(names_from = term,values_from = Pass)%>%
  View()
#FAILED students' mean semester GPA
aac.crs%>%group_by(term,coursecode,passfail)%>%
  summarise(mn=round(mean(Semester_GPA,na.rm=TRUE),digits=1))%>%
  filter(passfail%in%c("Fail"))%>%
  pivot_wider(names_from = passfail, values_from = mn)%>%
  pivot_wider(names_from = term,values_from = Fail)%>%
  View()
```

```{r pass vs fail by mean cumulative GPA}
#PASSED students' mean cumulative GPA
aac.crs%>%group_by(term,coursecode,passfail)%>%
  summarise(mn=round(mean(Cumulative_GPA,na.rm=TRUE),digits=1))%>%
  filter(passfail%in%c("Pass"))%>%
  pivot_wider(names_from = passfail, values_from = mn)%>%
  pivot_wider(names_from = term,values_from = Pass)%>%
  View()
#FAILED students' mean cumulative GPA
aac.crs%>%group_by(term,coursecode,passfail)%>%
  summarise(mn=round(mean(Cumulative_GPA,na.rm=TRUE),digits=1))%>%
  filter(passfail%in%c("Fail"))%>%
  pivot_wider(names_from = passfail, values_from = mn)%>%
  pivot_wider(names_from = term,values_from = Fail)%>%
  View()
```



```{r pass vs fail by semester GPA category}
#add category var (2.0 semester GPA)
aac.crs<-aac.crs%>%mutate(semGPA=case_when(Semester_GPA>=2~"higher than 2",
                                    Semester_GPA<2~"lower than 2"))#check: %>%count(semGPA)

#How many students PASS AAC103 and finish the semester with a 2.0 or higher vs lower semester GPA
#count for those who PASSED,  
#semGPA that higher than 2.0
aac.crs%>%group_by(term,coursecode,passfail,semGPA)%>%summarise(cnt=n())%>%
  mutate(prt=formattable::percent(cnt/sum(cnt),digits = 0))%>%
  filter(passfail%in%c("Pass"))%>%
  select(-cnt)%>%pivot_wider(names_from = passfail, values_from = prt)%>%
  pivot_wider(names_from = term,values_from = Pass)%>%
  filter(semGPA=="higher than 2")%>%select(-semGPA)%>%
  View()
#semGPA that lower than 2.0
aac.crs%>%group_by(term,coursecode,passfail,semGPA)%>%summarise(cnt=n())%>%
  mutate(prt=formattable::percent(cnt/sum(cnt),digits = 0))%>%
  filter(passfail%in%c("Pass"))%>%
  select(-cnt)%>%pivot_wider(names_from = passfail, values_from = prt)%>%
  pivot_wider(names_from = term,values_from = Pass)%>%
  filter(semGPA=="lower than 2")%>%select(-semGPA)%>%
  View()

#How many students FAIL AAC103 and finish the semester with a 2.0 or higher vs lower than a 2.0 semester GPA
#count for those who FAILED,  
#semGPA that higher than 2.0
aac.crs%>%group_by(term,coursecode,passfail,semGPA)%>%summarise(cnt=n())%>%
  mutate(prt=formattable::percent(cnt/sum(cnt),digits = 0))%>%
  filter(passfail%in%c("Fail"))%>%
  select(-cnt)%>%pivot_wider(names_from = passfail, values_from = prt)%>%
  pivot_wider(names_from = term,values_from = Fail)%>%
  filter(semGPA=="higher than 2")%>%select(-semGPA)%>%
  View()
#semGPA that lower than 2.0
aac.crs%>%group_by(term,coursecode,passfail,semGPA)%>%summarise(cnt=n())%>%
  mutate(prt=formattable::percent(cnt/sum(cnt),digits = 0))%>%
  filter(passfail%in%c("Fail"))%>%
  select(-cnt)%>%pivot_wider(names_from = passfail, values_from = prt)%>%
  pivot_wider(names_from = term,values_from = Fail)%>%
  filter(semGPA=="lower than 2")%>%select(-semGPA)%>%
  View()
```


```{r retake103 map out grades/gpa each term in time-order}
#how Studentsretake AAC103 impacts their retakeAAC103grade & semester GPA

# who are retaking courses:
# for aac103, when ppid in more than one term (it will show as more than one row in ppid-term table), then count ppid in the table and filter apperance>1
retake103id<-aac.crs%>%filter(coursecode=="AAC103",!is.na(passfail))%>%
  count(people_code_id,term)%>%count(people_code_id)%>%filter(n>1)#90 students

#save these retake students group
retake103df<-aac.crs%>%filter(people_code_id%in%retake103id$people_code_id,!is.na(passfail),coursecode=="AAC103")%>%
  unique()%>%arrange(people_code_id)%>%
  #distinguish term sequence
  mutate(term=factor(term,levels = c("2018 FALL","2019 SPRING","2019 FALL","2020 SPRING","2020 FALL","2021 SPRING","2021 FALL","2022 SPRING")),
    term_num=case_when(term=="2018 FALL"~1,term=="2019 SPRING"~2,term=="2019 FALL"~3,term=="2020 SPRING"~4,
    term=="2020 FALL"~5,term=="2021 SPRING"~6,term=="2021 FALL"~7,term=="2022 SPRING"~8))
  #check:%>%count(people_code_id)#write_xlsx("/Volumes/lasellshare/Faculty_Staff_Shares$/IR/Data and Analyses/Program Review/2022 AAC/aac103_retake.xlsx")

#transform term num
#retake103df%>%select(people_code_id,term_num,term)%>%pivot_wider(names_from = #term_num, values_from = term)%>%
#  select(which(colSums(is.na(.))<nrow(.)))%>%#remove NA values cols
#  unite(`1`,`2`,`3`,`4`,`5`,`6`,`7`,`8`, col = "counts", na.rm=TRUE, sep = #",")%>%#View()
#  #separate_rows(counts, sep = ",")#split into different rows
#  separate(counts,c("firstcount","secondcount","thirdcount","fourthcount","fifthcount"),sep=",")


#transform pass/fail in term-order
grades.change.table<-retake103df%>%select(people_code_id,term_num,passfail)%>%pivot_wider(names_from = term_num, values_from = passfail)%>%
  select(which(colSums(is.na(.))<nrow(.)))%>%#remove NA values cols
  unite(`1`,`2`,`3`,`4`,`5`,`6`,`7`,`8`, col = "counts", na.rm=TRUE, sep = ",")%>%#View()
  #separate_rows(counts, sep = ",")#split into different rows
  separate(counts,c("grade_1sttime","grade_2ndtime","grade_3rdtime","grade_4thtime","grade_5thtime"),sep=",")


#transform semGPA for each term in the order of terms
semGPA.change.table<-retake103df%>%select(people_code_id,term_num,semGPA)%>%pivot_wider(names_from = term_num, values_from = semGPA)%>%
  select(which(colSums(is.na(.))<nrow(.)))%>%#remove NA values cols
  unite(`1`,`2`,`3`,`4`,`5`,`6`,`7`,`8`, col = "counts", na.rm=TRUE, sep = ",")%>%#View()
  #separate_rows(counts, sep = ",")#split into different rows
  separate(counts,c("semGPA_1sttime","semGPA_2ndtime","semGPA_3rdtime","semGPA_4thtime","semGPA_5thtime"),sep=",")


retake.change<-full_join(grades.change.table,semGPA.change.table)%>%
  mutate(grade_1to2=case_when(
  grade_1sttime=="Pass"&grade_2ndtime=="Pass"~"Same Pass",
  grade_1sttime=="Fail"&grade_2ndtime=="Fail"~"Same Fail",
  grade_1sttime=="Fail"&grade_2ndtime=="Pass"~"Increase",
  grade_1sttime=="Pass"&grade_2ndtime=="Fail"~"Decrease"),
  #compare 1st to 2nd time taking aac103
  semGPA_1to2=case_when(
  semGPA_1sttime=="higher than 2"&semGPA_2ndtime=="higher than 2"~"Same >2",
  semGPA_1sttime=="lower than 2"&semGPA_2ndtime=="lower than 2"~"Same <2",
  semGPA_1sttime=="lower than 2"&semGPA_2ndtime=="higher than 2"~"Increase",
  semGPA_1sttime=="higher than 2"&semGPA_2ndtime=="lower than 2"~"Decrease"),
  #reorder
  grade_1to2=factor(grade_1to2,levels = c("Same Pass","Increase","Decrease","Same Fail")),
  semGPA_1to2=factor(semGPA_1to2,levels = c("Same >2","Increase","Decrease","Same <2")),
  
  #compare 2nd to 3rd time taking aac103
  grade_2to3=case_when(
  grade_2ndtime=="Pass"&grade_3rdtime=="Pass"~"Same Pass",
  grade_2ndtime=="Fail"&grade_3rdtime=="Fail"~"Same Fail",
  grade_2ndtime=="Fail"&grade_3rdtime=="Pass"~"Increase",
  grade_2ndtime=="Pass"&grade_3rdtime=="Fail"~"Decrease"),
  
  semGPA_2to3=case_when(
  semGPA_2ndtime=="higher than 2"&semGPA_3rdtime=="higher than 2"~"Same >2",
  semGPA_2ndtime=="lower than 2"&semGPA_3rdtime=="lower than 2"~"Same <2",
  semGPA_2ndtime=="lower than 2"&semGPA_3rdtime=="higher than 2"~"Increase",
  semGPA_2ndtime=="higher than 2"&semGPA_3rdtime=="lower than 2"~"Decrease"),
  #reorder
  grade_2to3=factor(grade_2to3,levels = c("Same Pass","Increase","Decrease","Same Fail")),
  semGPA_2to3=factor(semGPA_2to3,levels = c("Same >2","Increase","Decrease","Same <2")),
  
  
  #compare 3rd to 4th time taking aac103
  grade_3to4=case_when(
  grade_3rdtime=="Pass"&grade_4thtime=="Pass"~"Same Pass",
  grade_3rdtime=="Fail"&grade_4thtime=="Fail"~"Same Fail",
  grade_3rdtime=="Fail"&grade_4thtime=="Pass"~"Increase",
  grade_3rdtime=="Pass"&grade_4thtime=="Fail"~"Decrease"),
  
  semGPA_3to4=case_when(
  semGPA_3rdtime=="higher than 2"&semGPA_4thtime=="higher than 2"~"Same >2",
  semGPA_3rdtime=="lower than 2"&semGPA_4thtime=="lower than 2"~"Same <2",
  semGPA_3rdtime=="lower than 2"&semGPA_4thtime=="higher than 2"~"Increase",
  semGPA_3rdtime=="higher than 2"&semGPA_4thtime=="lower than 2"~"Decrease"),
  #reorder
  grade_3to4=factor(grade_3to4,levels = c("Same Pass","Increase","Decrease","Same Fail")),
  semGPA_3to4=factor(semGPA_3to4,levels = c("Same >2","Increase","Decrease","Same <2")),
  
  
  #compare 4th to 5th time taking aac103
  grade_4to5=case_when(
  grade_4thtime=="Pass"&grade_5thtime=="Pass"~"Same Pass",
  grade_4thtime=="Fail"&grade_5thtime=="Fail"~"Same Fail",
  grade_4thtime=="Fail"&grade_5thtime=="Pass"~"Increase",
  grade_4thtime=="Pass"&grade_5thtime=="Fail"~"Decrease"),
  
  semGPA_4to5=case_when(
  semGPA_4thtime=="higher than 2"&semGPA_5thtime=="higher than 2"~"Same >2",
  semGPA_4thtime=="lower than 2"&semGPA_5thtime=="lower than 2"~"Same <2",
  semGPA_4thtime=="lower than 2"&semGPA_5thtime=="higher than 2"~"Increase",
  semGPA_4thtime=="higher than 2"&semGPA_5thtime=="lower than 2"~"Decrease"),
  #reorder
  grade_4to5=factor(grade_4to5,levels = c("Same Pass","Increase","Decrease","Same Fail")),
  semGPA_4to5=factor(semGPA_4to5,levels = c("Same >2","Increase","Decrease","Same <2"))
  )

#write_xlsx(retake.change,"/Volumes/lasellshare/Faculty_Staff_Shares$/IR/Data and Analyses/Program Review/2022 AAC/aac103_retake_ordered.xlsx")
```


```{r report retake.aac103}
#how many passed/semgpa for the first time?
retake.change%>%group_by(semGPA_1sttime,grade_1sttime)%>%summarise(cnt=n())%>%mutate(prt=formattable::percent(cnt/sum(cnt),digits = 0))%>%select(-cnt)%>%
  pivot_wider(names_from = grade_1sttime, values_from = prt)%>%
  View()#around 14-21% students failed and a majority passed aac103; difference between different semGPA groups is only 7%
#report N
retake.change%>%count(semGPA_1sttime)

#compared grade in 2nd to 1st, Increase/Decrease/Same?
retake.change%>%group_by(grade_1to2)%>%summarise(cnt=n())%>%mutate(prt=formattable::percent(cnt/sum(cnt),digits = 0))%>%select(-cnt)%>%
  View()#

#compared semgpa in 2nd to 1st, Increase/Decrease/Same?
retake.change%>%group_by(semGPA_1to2)%>%summarise(cnt=n())%>%mutate(prt=formattable::percent(cnt/sum(cnt),digits = 0))%>%select(-cnt)%>%
  View()#



#how many have a 3rd term
retake.change%>%filter(!is.na(grade_2to3))%>%nrow()

#compared grade in 3rd to 2nd, Increase/Decrease/Same?
retake.change%>%filter(!is.na(grade_2to3))%>%
  group_by(grade_2to3)%>%summarise(cnt=n())%>%mutate(prt=formattable::percent(cnt/sum(cnt),digits = 0))%>%select(-cnt)%>%
  View()#

#compared semgpa in 3rd to 2nd, Increase/Decrease/Same?
retake.change%>%filter(!is.na(semGPA_2to3))%>%
  group_by(semGPA_2to3)%>%summarise(cnt=n())%>%mutate(prt=formattable::percent(cnt/sum(cnt),digits = 0))%>%select(-cnt)%>%
  View()#




#how many have a 4th term
retake.change%>%filter(!is.na(grade_3to4))%>%nrow()

#compared grade in 3rd to 2nd, Increase/Decrease/Same?
retake.change%>%filter(!is.na(grade_3to4))%>%
  group_by(grade_3to4)%>%summarise(cnt=n())%>%mutate(prt=formattable::percent(cnt/sum(cnt),digits = 0))%>%select(-cnt)%>%
  View()#

#compared semgpa in 3rd to 2nd, Increase/Decrease/Same?
retake.change%>%filter(!is.na(semGPA_3to4))%>%
  group_by(semGPA_3to4)%>%summarise(cnt=n())%>%mutate(prt=formattable::percent(cnt/sum(cnt),digits = 0))%>%select(-cnt)%>%
  View()#




#how many have a 5th term
retake.change%>%filter(!is.na(grade_4to5))%>%nrow()

#compared grade in 3rd to 2nd, Increase/Decrease/Same?
retake.change%>%filter(!is.na(grade_4to5))%>%
  group_by(grade_4to5)%>%summarise(cnt=n())%>%mutate(prt=formattable::percent(cnt/sum(cnt),digits = 0))%>%select(-cnt)%>%
  View()#

#compared semgpa in 3rd to 2nd, Increase/Decrease/Same?
retake.change%>%filter(!is.na(semGPA_4to5))%>%
  group_by(semGPA_4to5)%>%summarise(cnt=n())%>%mutate(prt=formattable::percent(cnt/sum(cnt),digits = 0))%>%select(-cnt)%>%
  View()#

```









