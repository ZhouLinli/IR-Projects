---
title: "FacultyTenureAnalysis"
author: "Linli Zhou"
format: pptx
editor: visual
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, include = TRUE, warning=FALSE, message=FALSE, fig.align = "center")
#theme
source("/Users/linlizhou/Documents/Rprojects/IR-Projects/theme_source.R")  #run code from saved r script
#load data
data<-read_excel("/Users/linlizhou/Documents/LASELL/Faculty Data for Analyst Candidates.xlsx")
```

# Agenda

- Tenure status by year
- Tenure status by demography (rank, sex, race)
- Tenure status for small, medium, and large department

```{r clean, results='hide'}

#remove duplicated rows

data<-unique(data)#from 4003 to 3984 observations

#remove duplicated ID/persons

unique(data$ID)%>%length()#1147 unique ID

data%>% group_by(ID) %>% summarise(cnt=n()) %>%arrange(-cnt) %>%filter(cnt>1) #815 duplicated IDs
```


# Tenure Status by Year

::: notes
- Tenured percentage has been increased since 2016 from 40% to 44% in 2021, with 2020 being the highest 45%. 
- Non-tenured faculty percentage has been decreased from 60% to 56%, with 2020 being the lowest 55%. 
- There are still 12% less tenured faculty than non tenured.
::: 

```{r unique TvsN across year}

data%>%group_by(Year, `Tenure Status`)%>%

summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits=0))%>%

ggplot(aes(color=factor(`Tenure Status`),x=factor(Year),y=prt,group=factor(`Tenure Status`)))+geom_line()+

geom_text(aes(label=prt),fontface="bold", size = 9)+

theme_lz_ppt()+

scale_y_continuous(breaks = seq(.4,.6,by=.05),labels = scales::percent)+

labs(title="Tenured Status by Year",x="Year",y="")+

scale_color_discrete(labels=c("Non-tenure","Tenure"),name="")+

theme(axis.text.y=element_blank())+
theme(axis.title.x =element_blank())

#scale_color_discrete(values = c("Non-tenure"=mycolors[4],"Tenure"=mycolors[1]),name="")

#geom_bar(stat = "identity", position=position_dodge())
```


```{r TvsN across year, include=FALSE}


data%>%group_by(Year, `Tenure Status`)%>%summarise(cnt=n())%>%mutate(prt=percent(cnt/sum(cnt),digits=0))%>%

ggplot(aes(color=factor(`Tenure Status`),x=factor(Year),y=prt,group=factor(`Tenure Status`)))+geom_line()+

geom_text(aes(label=prt), size = 9)+

theme_lz_ppt()+

scale_y_continuous(breaks = seq(.4,.6,by=.05),labels = scales::percent)+

labs(title="",x="Year",y="",fill="")+

scale_color_discrete(labels=c("Non-tenure","Tenure"),name="")

#scale_color_discrete(values = c("Non-tenure"=mycolors[4],"Tenure"=mycolors[1]),name="")

#geom_bar(stat = "identity", position=position_dodge())

```

# Tenure Status by Rank, Race, and Sex

::: notes
Assistant Professor has 64% Tenured status, 4% higher than Professor and 6% higher than Associate Professor.
::: 

```{r tenure by rank, fig.width=8}

data%>% filter(Rank=="Professor"|Rank=="Assistant Professor"| Rank=="Associate Professor")%>%

group_by(Rank,`Tenure Status`)%>%summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits=0))%>%

ggplot(aes(fill=factor(`Tenure Status`),x=factor(Rank),y=prt))+

geom_bar(stat = "identity",position = position_dodge())+

geom_text(aes(label=prt),position=position_dodge(.9),vjust=1.5,color="white",fontface="bold", size= 9 )+theme_lz_ppt()+

scale_fill_discrete(labels=c("Non-tenure","Tenure"),name="")+
  scale_x_discrete(labels=c("Assistant Prof", "Associate Prof", "Professor"))+

labs(x="",y="",title="Tenured Status by Rank")

```


::: notes
Male faculty has 8% more tenured rate than female faculty.
::: 

```{r tenure by sex, fig.width=6}

data%>% filter(`Legal Sex`!="Unreported") %>% group_by(`Legal Sex`,`Tenure Status`)%>% summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits=0))%>%

ggplot(aes(fill=factor(`Tenure Status`),x=factor(`Legal Sex`),y=prt))+

geom_bar(stat = "identity",position = position_dodge())+

geom_text(aes(label=prt),position=position_dodge(.9),vjust=1.5,color="white",fontface="bold", size = 9)+theme_lz_ppt()+

scale_fill_discrete(labels=c("Non-tenure","Tenure"),name="")+

labs(x="",y="",title="Tenured Status by Legal Sex")

```



::: notes
Faculty from two or more races has the highest tenured rate, 50%. Hispanic and White faculty have 39% tenured rate. Asian has 38%, African American has 36%, and International has the lowest 34% tenured rate.
::: 

```{r tenure-by-race}
#set order

race.order<-data%>%filter(`Race/Ethnicity`!=c ("Unreported",NA) )%>%

  group_by(`Race/Ethnicity`,`Tenure Status`)%>%summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits=0))%>%filter(`Tenure Status`=="Tenure Line")%>%arrange(prt)%>%mutate(race.f=factor(`Race/Ethnicity`))

data%>%filter(`Race/Ethnicity`!=c ("Unreported",NA) )%>%

  group_by(`Race/Ethnicity`,`Tenure Status`)%>%summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits=0))%>%

ggplot(aes(fill=factor(`Tenure Status`),y=factor(`Race/Ethnicity`),x=prt))+

  geom_bar(stat = "identity",position = position_dodge())+

  geom_text(aes(label=prt),position=position_dodge(.9),hjust=1,color="white",fontface="bold", size = 9)+theme_lz_ppt()+

  scale_fill_discrete(labels=c("Non-tenure","Tenure"),name="")+

  labs(x="",y="",title="Tenured Status by Racial Groups")+

  scale_y_discrete(limits=race.order$race.f)+

  theme(axis.text.x = element_blank(),axis.text.y = element_text(size = 20))
```


# Departmental Tenure Status

```{r top n dep, include=FALSE}
#Department that has top 6 number (unique ID/person) faculty

topdep<-data%>%group_by(Department)%>%summarise(cnt=n_distinct(ID))%>%arrange(-cnt)%>%head()

#check top department's T/NT

data%>%filter(Department %in% topdep[[1]]) %>%

  group_by(Department,`Tenure Status`)%>%

  summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits = 0))%>%arrange(-prt)

```

```{r dep groups, results='hide'}
#make department count as ndep

ndep<-data%>%group_by(Department)%>%summarise(cnt=n_distinct(ID))%>%arrange(-cnt)#

#four groups based on department count

ndep[ndep$cnt>30,]%>%str() #11 giant departments

ndep[ndep$cnt%in%seq(21,30,by=1),]%>%str() #13 large departments

ndep[ndep$cnt%in%seq(5,20,by=1),]%>%str()#14 medium departments

ndep[ndep$cnt<5,]%>%str()#14 small departments

ndep[ndep$cnt>20,]%>%str() #24 large departments

ndep[ndep$cnt>30,]%>%str() #11 giant departments

ndep[ndep$cnt%in%seq(21,30,by=1),]%>%str() #13 large departments

ndep[ndep$cnt%in%seq(5,20,by=1),]%>%str()#14 medium departments

ndep[ndep$cnt<5,]%>%str()#14 small departments

#order based on tenure prt -- exclude those without any tenure

dep.order.t<-data%>%group_by(Department,`Tenure Status`)%>%

  summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits = 0))%>%

  filter(`Tenure Status`=="Tenure Line")%>%arrange(prt)%>%

  mutate(dep.f=factor(Department))

#excluded in order

order.exclude<-data[( data$Department %in% dep.order.t$dep.f ) == FALSE,] %>%group_by(Department)%>%

  summarise(cnt=n_distinct(ID)) %>% arrange(cnt) %>% mutate(dep.xf=factor(Department))

dep.order<-c(order.exclude$dep.xf,dep.order.t$dep.f)
```

```{r dep n>20, fig.height=8}
#first group n>20, 24 large departments

data%>%filter(Department %in% ndep[ndep$cnt>20,1]$Department ) %>%

  group_by(Department,`Tenure Status`)%>%

  summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits = 0))%>%

  ggplot(aes(x=Department,y=prt,fill=`Tenure Status`))+geom_bar(stat = "identity")+

  scale_x_discrete(limits = dep.order[(dep.order %in% ndep[ndep$cnt>20,1]$Department)==TRUE])+

  theme_lz_ppt()+geom_text(aes(label=prt),position = position_stack(),hjust=1,color="white", size = 9)+

  coord_flip()+theme(axis.text.x = element_blank())+

  theme(axis.text.y=element_text(size = 20))+

  scale_fill_discrete(labels=c("Non-tenure","Tenure"),name="")+

  labs(x="",y="", title="Tenure for Large Departments (>20 faculty)")
```

```{r dep n>30}
#first group n>30, 11 giant departments

data%>%filter(Department %in% ndep[ndep$cnt>30,1]$Department ) %>%

  group_by(Department,`Tenure Status`)%>%

  summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits = 0))%>%

  ggplot(aes(x=Department,y=prt,fill=`Tenure Status`))+geom_bar(stat = "identity")+

  scale_x_discrete(limits = dep.order[(dep.order %in% ndep[ndep$cnt>30,1]$Department)==TRUE])+

  theme_lz_ppt()+geom_text(aes(label=prt),position = position_stack(),hjust=1,color="white", size = 9)+

  coord_flip()+theme(axis.text.x = element_blank())+

  theme(axis.text.y=element_text(size = 20))+

  scale_fill_discrete(labels=c("Non-tenure","Tenure"),name="")+

  labs(x="",y="", title="Tenure for Giant Departments (>30 faculty)")
```

```{r dep n21-30}
#13 large departments

data%>%filter(Department %in% ndep[ndep$cnt%in%seq(21,30,by=1),1]$Department ) %>%

  group_by(Department,`Tenure Status`)%>%

  summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits = 0))%>%

  ggplot(aes(x=Department,y=prt,fill=`Tenure Status`))+geom_bar(stat = "identity")+

  scale_x_discrete(limits = dep.order[dep.order %in% 

                                              ndep[ndep$cnt%in%seq(21,30,by=1),1]$Department 

                                            ])+

  theme_lz_ppt()+geom_text(aes(label=prt),position = position_stack(),hjust=1, color="white", size = 9)+

  coord_flip()+theme(axis.text.x = element_blank())+

  theme(axis.text.y=element_text(size = 20))+

  labs(x="",y="",title=str_wrap("Tenure for Large Departments (21-30 faculty)",35))
```

```{r dep n5-20}
#22 medium departments

data%>%filter(Department %in% ndep[ndep$cnt%in%seq(5,20,by=1),1]$Department ) %>%

  group_by(Department,`Tenure Status`)%>%

  summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits = 0))%>%

  ggplot(aes(x=Department,y=prt,fill=`Tenure Status`))+geom_bar(stat = "identity")+

  scale_x_discrete(limits = dep.order[dep.order %in% 

                                              ndep[ndep$cnt%in%seq(5,20,by=1),1]$Department 

                                            ])+

  theme_lz_ppt()+geom_text(aes(label=prt),position = position_stack(),hjust=1, color="white", size = 9)+

  coord_flip()+theme(axis.text.x = element_blank())+

  theme(axis.text.y=element_text(size = 20))+

  labs(x="",y="",title=str_wrap("Tenure for Medium-size Departments (5-20 faculty)",35))
```

```{r n<5}
#14 medium departments

data%>%filter(Department %in% ndep[ndep$cnt<5,1]$Department ) %>%

  group_by(Department,`Tenure Status`)%>%

  summarise(cnt=n_distinct(ID))%>%mutate(prt=percent(cnt/sum(cnt),digits = 0))%>%

  ggplot(aes(x=Department,y=prt,fill=`Tenure Status`))+geom_bar(stat = "identity")+

  scale_x_discrete(limits = dep.order[dep.order %in% 

                                              ndep[ndep$cnt<5,1]$Department 

                                            ])+

  theme_lz_ppt()+geom_text(aes(label=prt),position = position_stack(),hjust=1, color="white", size = 9)+

  coord_flip()+theme(axis.text.x = element_blank())+

  theme(axis.text.y=element_text(size = 20))+

  labs(x="",y="",title=str_wrap("Tenure for Medium-size Departments (<5 faculty)",35))
```
